<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.dong.BoardMapper">

<!-- 전체게시판 리스트 -->
<select id="getTotalCount" resultType="int" parameterType="map">
        SELECT COUNT(*) as totalCount
        FROM board
        WHERE del = 1
    </select>

   <select id="getListByRange" resultType="kr.co.dong.board.BoardDTO" parameterType="java.util.Map">
    SELECT *
    FROM board
    WHERE del = 1
    <if test="keyword != null and keyword != ''">
        AND (
            id LIKE CONCAT('%', #{keyword}, '%')
            OR title LIKE CONCAT('%', #{keyword}, '%')
            OR type LIKE CONCAT('%', #{keyword}, '%')
            OR regdate LIKE CONCAT('%', #{keyword}, '%')
        )
    </if>
    ORDER BY
    <choose>
        <when test="sortBy eq 'id'">id ASC</when>
        <when test="sortBy eq 'title'">title ASC</when>
        <when test="sortBy eq 'idDesc'">id DESC</when>
        <when test="sortBy eq 'titleDesc'">title DESC</when>
        <when test="sortBy eq 'regdate'">regdate ASC</when>
        <when test="sortBy eq 'regdateDesc'">regdate DESC</when>
        <when test="sortBy eq 'defalut'">CASE WHEN type = 1 THEN 0 ELSE 1 END, regdate DESC</when>
        <otherwise>CASE WHEN type = 1 THEN 0 ELSE 1 END, regdate DESC</otherwise>
    </choose>
    LIMIT #{startIdx}, #{endIdx}
</select>

<!-- 공지사항 리스트 -->
<select id="getTotalCount1" resultType="int" parameterType="map">
        SELECT COUNT(*) as totalCount
        FROM board
        WHERE type = 1
        and del = 1
    </select>

   <select id="getListByRange1" resultType="kr.co.dong.board.BoardDTO" parameterType="java.util.Map">
    SELECT *
    FROM board
    WHERE type = 1
    and del = 1
    <if test="keyword != null and keyword != ''">
        AND (
            id LIKE CONCAT('%', #{keyword}, '%')
            OR title LIKE CONCAT('%', #{keyword}, '%')
            OR type LIKE CONCAT('%', #{keyword}, '%')
            OR regdate LIKE CONCAT('%', #{keyword}, '%')
        )
    </if>
    ORDER BY
    <choose>
        <when test="sortBy eq 'id'">id ASC</when>
        <when test="sortBy eq 'title'">title ASC</when>
        <when test="sortBy eq 'idDesc'">id DESC</when>
        <when test="sortBy eq 'titleDesc'">title DESC</when>
        <when test="sortBy eq 'regdate'">regdate ASC</when>
        <when test="sortBy eq 'regdateDesc'">regdate DESC</when>
        <when test="sortBy eq 'defalut'">CASE WHEN type = 1 THEN 0 ELSE 1 END, regdate DESC</when>
        <otherwise>CASE WHEN type = 1 THEN 0 ELSE 1 END, regdate DESC</otherwise>
    </choose>
    LIMIT #{startIdx}, #{endIdx}
</select>

<!-- 자유게시판 리스트 -->
<select id="getTotalCount2" resultType="int" parameterType="map">
        SELECT COUNT(*) as totalCount
        FROM board
        WHERE type = 2
        and del = 1
    </select>

   <select id="getListByRange2" resultType="kr.co.dong.board.BoardDTO" parameterType="java.util.Map">
    SELECT *
    FROM board
    WHERE type = 2
    and del = 1
    <if test="keyword != null and keyword != ''">
        AND (
            id LIKE CONCAT('%', #{keyword}, '%')
            OR title LIKE CONCAT('%', #{keyword}, '%')
            OR type LIKE CONCAT('%', #{keyword}, '%')
            OR regdate LIKE CONCAT('%', #{keyword}, '%')
        )
    </if>
    ORDER BY
    <choose>
        <when test="sortBy eq 'id'">id ASC</when>
        <when test="sortBy eq 'title'">title ASC</when>
        <when test="sortBy eq 'idDesc'">id DESC</when>
        <when test="sortBy eq 'titleDesc'">title DESC</when>
        <when test="sortBy eq 'regdate'">regdate ASC</when>
        <when test="sortBy eq 'regdateDesc'">regdate DESC</when>
        <when test="sortBy eq 'defalut'">CASE WHEN type = 1 THEN 0 ELSE 1 END, regdate DESC</when>
        <otherwise>CASE WHEN type = 1 THEN 0 ELSE 1 END, regdate DESC</otherwise>
    </choose>
    LIMIT #{startIdx}, #{endIdx}
</select>

<!-- 공지사항 리스트 -->
<select id="getTotalCount3" resultType="int" parameterType="map">
        SELECT COUNT(*) as totalCount
        FROM board
        WHERE type = 3
        and del = 1
    </select>

   <select id="getListByRange3" resultType="kr.co.dong.board.BoardDTO" parameterType="java.util.Map">
    SELECT *
    FROM board
    WHERE type = 3
    and del = 1
    <if test="keyword != null and keyword != ''">
        AND (
            id LIKE CONCAT('%', #{keyword}, '%')
            OR title LIKE CONCAT('%', #{keyword}, '%')
            OR type LIKE CONCAT('%', #{keyword}, '%')
            OR regdate LIKE CONCAT('%', #{keyword}, '%')
        )
    </if>
    ORDER BY
    <choose>
        <when test="sortBy eq 'id'">id ASC</when>
        <when test="sortBy eq 'title'">title ASC</when>
        <when test="sortBy eq 'idDesc'">id DESC</when>
        <when test="sortBy eq 'titleDesc'">title DESC</when>
        <when test="sortBy eq 'regdate'">regdate ASC</when>
        <when test="sortBy eq 'regdateDesc'">regdate DESC</when>
        <when test="sortBy eq 'defalut'">CASE WHEN type = 1 THEN 0 ELSE 1 END, regdate DESC</when>
        <otherwise>CASE WHEN type = 1 THEN 0 ELSE 1 END, regdate DESC</otherwise>
    </choose>
    LIMIT #{startIdx}, #{endIdx}
</select>
   
   <insert id="boardInsert"  parameterType="kr.co.dong.board.BoardDTO">
    
    insert into board (id, title, content, type, likecnt, viewcnt, regdate, del)
    VALUES (#{id}, #{title}, #{content}, #{type}, 0, 0, now(), 1)

</insert>

   <!-- 게시물 상세 조회 -->
   <select id="boardDetail" parameterType="java.lang.Integer" resultType="kr.co.dong.board.BoardDTO">
      select *
      from board
      where bno= #{bno}
      limit 1;
   </select>
   
   <update id="updateLikeCount" parameterType="kr.co.dong.board.BoardDTO">
    UPDATE board SET likecnt = likecnt + 1 WHERE bno = #{bno}
  </update>
  
   <update id="downLikeCount" parameterType="kr.co.dong.board.BoardDTO">
    UPDATE board SET likecnt = likecnt - 1 WHERE bno = #{bno}
  </update>
  
     <!-- 게시글 삭제 -->
   <update id="boardDelete" parameterType="kr.co.dong.board.BoardDTO">
        update board
        set del = 3
        where bno = #{bno};
    </update>
    
       <!-- 게시물 수정 -->
   <update id="boardUpdate" parameterType="kr.co.dong.book.bookDTO">
  UPDATE board
  SET title = #{title},
       content = #{content}
  WHERE bno = #{bno}
</update>

   <!-- 조회수 증가 -->
      <update id="viewcntUp" parameterType="kr.co.dong.book.bookDTO">
  UPDATE board
  SET viewcnt = viewcnt + 1
  WHERE bno = #{bno}
</update>
  
 

  </mapper>